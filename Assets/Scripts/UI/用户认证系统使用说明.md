# 用户认证系统使用说明

## 概述

本系统在原有的电力线可视化系统基础上，添加了用户认证功能。用户必须先登录或注册，然后才能访问系统的主要功能。

## 系统架构

### 核心组件

1. **SimpleUserAuth** - 用户认证管理器
   - 负责用户注册、登录、登出
   - 管理用户数据和会话
   - 提供认证事件

2. **InitialInterfaceManager** - 初始界面管理器（已修改）
   - 在启动时显示登录界面
   - 用户登录成功后显示主界面
   - 管理界面切换逻辑

3. **AuthTestScript** - 测试脚本
   - 用于测试认证功能
   - 提供调试信息

## 使用方法

### 1. 场景设置

在Unity场景中，需要添加以下组件：

#### 添加SimpleUserAuth组件
1. 在场景中创建一个空的GameObject
2. 命名为"UserAuthSystem"
3. 添加`SimpleUserAuth`组件

#### 修改InitialInterfaceManager
1. 找到场景中的`InitialInterfaceManager`组件
2. 在Inspector中，将`SimpleUserAuth`组件拖拽到`Auth System`字段

### 2. 运行流程

1. **启动时**：系统自动显示登录界面
2. **用户注册**：点击"没有账号？点击注册"进入注册界面
3. **用户登录**：输入用户名和密码进行登录
4. **登录成功**：自动跳转到主界面（原有的电力线系统界面）
5. **用户登出**：在主界面中可以登出，返回登录界面

### 3. 测试功能

添加`AuthTestScript`组件到场景中，可以：

- 右键点击组件，选择"测试用户注册"
- 右键点击组件，选择"测试用户登录"
- 右键点击组件，选择"测试用户登出"
- 右键点击组件，选择"显示所有用户"
- 右键点击组件，选择"检查登录状态"

## 数据存储

- 用户数据保存在：`Application.persistentDataPath/users.json`
- 数据格式：JSON格式，包含用户ID、用户名、邮箱、密码等信息

## 安全特性

- 密码验证：用户名长度≥3，密码长度≥6
- 重复检查：防止重复用户名注册
- 会话管理：登录状态维护

## 界面说明

### 登录界面
- 用户名输入框
- 密码输入框（隐藏显示）
- 登录按钮
- 切换到注册的链接

### 注册界面
- 用户名输入框
- 邮箱输入框
- 密码输入框（隐藏显示）
- 确认密码输入框（隐藏显示）
- 注册按钮
- 切换到登录的链接

### 主界面
- 原有的电力线系统界面
- 包含三个功能选择面板
- 文件上传和Python环境配置功能

## 故障排除

### 常见问题

1. **登录界面不显示**
   - 检查`SimpleUserAuth`组件是否正确配置
   - 查看Console中的调试信息
   - 确保`InitialInterfaceManager`中的`Auth System`字段已设置

2. **注册失败**
   - 检查用户名长度是否≥3
   - 检查密码长度是否≥6
   - 检查邮箱格式是否正确
   - 检查用户名是否已存在

3. **登录失败**
   - 检查用户名和密码是否正确
   - 确认用户已注册
   - 查看Console中的错误信息

### 调试信息

系统会在Console中输出详细的调试信息：
- 界面创建状态
- 用户认证过程
- 界面切换操作
- 错误和警告信息

## 扩展功能

### 添加新用户角色
可以在`UserData`类中添加新的用户属性，如：
- 用户权限级别
- 用户偏好设置
- 使用历史记录

### 集成数据库
可以修改`SimpleUserAuth`类，将数据存储改为数据库：
- MySQL/PostgreSQL
- SQLite
- MongoDB等

### 添加更多安全特性
- 密码加密存储
- 登录尝试限制
- 双因素认证
- 密码重置功能

## 注意事项

1. **开发环境**：确保Unity版本支持UI Toolkit
2. **数据安全**：当前版本密码为明文存储，生产环境需要加密
3. **性能优化**：大量用户时考虑数据分页和缓存
4. **错误处理**：添加更多的用户友好的错误提示

## 联系支持

如有问题或建议，请查看Console日志信息，或联系开发团队。
