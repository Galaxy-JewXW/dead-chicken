# 视角切换自动寻找电塔功能说明

## 功能概述

现在视角切换系统已经升级，当您切换视角时，相机会自动寻找最近的电塔位置并移动到那里，而不是使用固定的视角位置。这样可以确保您始终能够观察到电力线系统的重要部分。

## 主要特性

### 1. 自动寻找最近电塔
- 切换视角时自动检测场景中的电塔
- 计算相机当前位置到各个电塔的距离
- 选择最近的电塔作为目标位置

### 2. 智能视角位置计算
- **第一人称视角**：在电塔附近的地面，高度为地面高度+3米
- **上帝视角**：在电塔上方100米，稍微后退以获得更好的俯视角度
- **飞行视角**：在电塔上方20米，斜向偏移以获得更好的观察角度

### 3. 多种电塔查找方式
- 优先通过标签查找（"Tower"、"GoodTower"）
- 备用方案：通过TowerOverviewManager组件查找
- 确保在各种情况下都能找到电塔

## 使用方法

### 基本操作
1. **F1键**：切换到第一人称视角（自动移动到最近电塔附近）
2. **F2键**：切换到上帝视角（自动移动到最近电塔上方）
3. **F3键**：切换到飞行视角（自动移动到最近电塔附近空中）

### 高级功能
- **自动寻找电塔开关**：可以通过代码控制是否启用自动寻找功能
- **位置刷新**：可以强制刷新当前视角位置，重新计算到最近电塔的位置

## 配置选项

在CameraManager组件中，您可以调整以下设置：

```csharp
[Header("电塔查找设置")]
public bool autoFindNearestTower = true;        // 是否启用自动寻找电塔
public string towerTag = "Tower";               // 电塔查找标签
```

## 技术实现

### 核心方法

1. **FindNearestTowerPosition()**：查找最近的电塔位置
2. **CalculateViewPosition()**：根据电塔位置计算不同视角的相机位置
3. **RefreshCurrentViewPosition()**：强制刷新当前视角位置

### 查找策略

1. **标签查找**：使用GameObject.FindGameObjectsWithTag查找标记为"Tower"或"GoodTower"的对象
2. **组件查找**：通过TowerOverviewManager.GetAllTowers()获取所有电塔信息
3. **距离计算**：使用Vector3.Distance计算相机到各个电塔的距离，选择最近的

## 测试脚本

项目包含了一个测试脚本`CameraManagerTest.cs`，可以用来验证功能是否正常工作：

- 自动测试视角切换功能
- 测试位置刷新功能
- 提供UI界面进行手动测试

## 注意事项

1. **电塔标签**：确保电塔对象有正确的标签（"Tower"或"GoodTower"）
2. **TowerOverviewManager**：如果使用组件查找方式，需要确保场景中有TowerOverviewManager组件
3. **性能考虑**：电塔查找操作在每次视角切换时执行，如果电塔数量很多，可能需要优化

## 故障排除

### 常见问题

1. **找不到电塔**：
   - 检查电塔对象是否有正确的标签
   - 确认场景中是否有电塔对象
   - 检查TowerOverviewManager是否正确配置

2. **视角位置不正确**：
   - 检查电塔的位置数据是否正确
   - 确认地面高度检测是否正常工作
   - 可以尝试手动刷新视角位置

3. **性能问题**：
   - 如果电塔数量很多，考虑禁用自动寻找功能
   - 或者优化电塔查找算法

## 更新日志

- **v1.0**：初始版本，实现基本的自动寻找电塔功能
- 支持三种视角的智能位置计算
- 多种电塔查找策略
- 完整的测试和调试功能
